{"componentChunkName":"component---src-templates-blog-post-js","path":"/troubleshooting/js-this/","result":{"data":{"site":{"siteMetadata":{"title":"하일의 작업실"}},"markdownRemark":{"id":"7cd25617-fbca-59ef-afd5-423ecd315638","excerpt":"…","html":"<h2>1. 문제 발생</h2>\n<p>바닐라 자바스크립트로 간단한 메뉴 보드를 만들고 있었습니다.</p>\n<p>여기서 메뉴 보드란, 각 메뉴의 카테고리가 있고 해당 카테고리에 속한 메뉴를 사용자에게 보여주는 앱입니다.</p>\n<p>카테고리마다 버튼이 존재하고, 사용자가 그 버튼을 누르면 카테고리에 속한 메뉴를 보여주는 것입니다.</p>\n<p>예를 들어 '커피'라고 적힌 버튼을 누르면 '커피' 카테고리에 속한 메뉴(아메리카노, 카페라떼 등)가 사용자에게 보여지는 것입니다.</p>\n<p>아래에 보이는 코드는, 그 메뉴보드 앱의 뼈대입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentCategory <span class=\"token operator\">=</span> <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 오늘의 주인공</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">changeCategory</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ... </span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nav\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> changeCategory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 코드는 정상적으로 작동했지만  <code class=\"language-text\">changeCategory</code> 라는 함수를 <code class=\"language-text\">initEventListener</code> 라는 메서드 밖으로 꺼내고 싶었습니다.</p>\n<p><code class=\"language-text\">changeCategory</code>는 이벤트리스너로 사용될 함수니까, <code class=\"language-text\">initEventListener</code> 라는 메서드에 속해있어도 문제는 없지만, 레이어를 분리해서 함수는 함수끼리, 이벤트리스너는 이벤트리스너끼리 모으고 싶었습니다.</p>\n<p>그래서 처음에는 아래와 같이 리팩터링했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentCategory <span class=\"token operator\">=</span> <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// changeCategory를 initEventListener에서 분리하여 App 클래스의 매서드로 정의했다.</span>\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token comment\">//...</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// changeCategory를 App 클래스의 매서드로 선언했기 때문에, this를 붙여줬다.</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nav\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>changeCategory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러나 다음과 같은 에러가 발생했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">🚫 Uncaught TypeError: this.render is not a function\n at HTMLElement.changeCategory</code></pre></div>\n<p><code class=\"language-text\">this.render</code>가 함수가 아니라는 의미입니다.</p>\n<p><code class=\"language-text\">this.render</code>가 함수가 아니라면 실행될 수 없기 때문에,</p>\n<p>카테고리 버튼을 눌렀음에도 해당 카테고리에 속한 아이템들을 화면에 렌더링하지 못 했습니다.</p>\n<h2>2. 원인 분석</h2>\n<p>저는 정말 의아했습니다.</p>\n<p>위의 코드에서 <code class=\"language-text\">init</code>과 <code class=\"language-text\">changeCategory</code>는 모두 <code class=\"language-text\">App</code>이라는 클래스 레벨의 스코프에 속해있는 메서드입니다.</p>\n<p><code class=\"language-text\">init</code>에서 <code class=\"language-text\">this.render</code>를 실행했을 때는 문제가 없는데,</p>\n<p><code class=\"language-text\">init</code>과 같은 스코프에 속한 <code class=\"language-text\">changeCategory</code>에서는 왜 <code class=\"language-text\">this.render</code>를 실행할 수 없는 것일까요?</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 이건 되고</span>\n\t\t<span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 이건 안 된다고??</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이때 생각했던 원인은 <code class=\"language-text\">this</code> 바인딩이었습니다.</p>\n<p><code class=\"language-text\">init</code> 안에서 실행한 <code class=\"language-text\">this.render</code>는 문제가 없었습니다.</p>\n<p>그러면 <code class=\"language-text\">changeCategory</code> 안에서 실행한 <code class=\"language-text\">this.render</code>가 문제라는 것입니다.</p>\n<p>철자 하나 틀린 것 없이 똑같은 <code class=\"language-text\">this.render</code>에서 유일하게 차이를 찾는다면,</p>\n<p><code class=\"language-text\">this.render</code>에 바인딩된 <code class=\"language-text\">this</code>가 서로 다르다는 것밖에 없었습니다.</p>\n<p>하지만 여전히 의아했습니다.</p>\n<p><code class=\"language-text\">init</code>과 <code class=\"language-text\">changeCategory</code>는 모두 <code class=\"language-text\">App</code>이라는 클래스 레벨의 스코프에 정의되어있는 메서드입니다.</p>\n<p>그리고 <code class=\"language-text\">App</code>이라는 클래스 내부의 <code class=\"language-text\">this</code>는 앞으로 생성될 인스턴스를 가리킨다는 사실도 저는 알고 있었습니다.</p>\n<p>그러면 <code class=\"language-text\">init</code>과 <code class=\"language-text\">changeCategory</code>의 <code class=\"language-text\">this</code>가 가리키는 대상은 클래스 <code class=\"language-text\">App</code>이 생성할 인스턴스로 동일해야할 터인데,</p>\n<p>어째서 차이가 발생한 것일까요?</p>\n<p>이를 확인하기 위해, 먼저 <code class=\"language-text\">init</code>과 <code class=\"language-text\">changeCategory</code>가 가리키는  <code class=\"language-text\">this</code>가 무엇인지 알아보기 위해 콘솔을 찍어봤습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"init의 this\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// init의 this: App {menu: {…}, currentCategory: 'coffee'}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"changeCategory의 this\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// changeCategory의 this: &lt;nav clss=\"...\">...&lt;/nav></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>콘솔을 찍어보니 원인은 분명 <code class=\"language-text\">this</code> 바인딩의 차이였습니다.</p>\n<p><code class=\"language-text\">init</code>의 <code class=\"language-text\">this</code>는 <code class=\"language-text\">App</code> 클래스의 인스턴스를 가리키고 있었고,</p>\n<p><code class=\"language-text\">changeCategory</code>의 <code class=\"language-text\">this</code>는 <code class=\"language-text\">nav</code> 태그를 가리키고 있었습니다.</p>\n<p>(<code class=\"language-text\">nav</code> 태그는 각 카테고리의 버튼을 모아둔 내비게이션입니다.)</p>\n<h2>3. 왜 이런 현상이 발생했을까?</h2>\n<p>이 현상을 이해하기 위해서는 이 사실을 인지하고 가는 것이 중요합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">this가 가리키는 값은 함수가 어떻게 호출되었는지에 따라 동적으로 결정된다.</code></pre></div>\n<p>함수 호출 방식에 따른 <code class=\"language-text\">this</code> 바인딩은 아래와 같은 차이가 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. 일반 함수 호출 \n   - this에 전역 객체가 바인딩된다.\n\n2. 메서드 호출 \n   - 메서드를 호출할 때는 메서드 이름 앞의 마침표(.) 연산자 앞에 기술한 객체가 바인딩된다.\n\n3. 생성자 함수 or 클래스 호출 \n   - 생성자 함수 or 클래스 내부의 this에는 (미래에) 생성할 인스턴스가 바인딩된다. \n\n4. Function.prototype.apply/call/bind 메서드에 의한 간접 호출 \n   - this에 인수로 전달한 객체가 바인딩된다.</code></pre></div>\n<p>위의 사실을 인지한 상태에서, 에러가 발생했던 코드를 다시 확인해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentCategory <span class=\"token operator\">=</span> <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// ① init()이 호출될 곳은 클래스 App의 인스턴스 내부이다.</span>\n\t\t<span class=\"token comment\">//    따라서 init()의 this에는 App의 인스턴스가 바인딩 된다.</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ② init()의 this에는 App의 인스턴스가 바인딩 되어있다.</span>\n    <span class=\"token comment\">//    따라서 App의 메서드인 this.render()가 정상 작동한다.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n\t\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token comment\">//...</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ③ 그런데 이건 함수호출하는게 아니라 이벤트 핸들러로 전달할 뿐인데...?</span>\n    <span class=\"token comment\">//    이건 무슨 경우지...?</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nav\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>changeCategory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>함수 호출 방식에 따라 <code class=\"language-text\">this</code> 바인딩이 어떻게 이뤄지는 지는 위에서 확인했습니다.</p>\n<p>하지만 함수를 호출하는 것이 아니라 <code class=\"language-text\">addEvnetListener</code>에 인자로 전달할 뿐인 경우는 어떻게 <code class=\"language-text\">this</code> 바인딩이 이뤄지는 지는 걸까요?</p>\n<p>MDN의 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#other_notes\">EventTarget.addEventListener()</a> 문서에서 그 이유를 알 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">When attaching a handler function to an element using `addEventListener()`,\nthe value of this inside the handler will be a reference to the element.\n\n`addEventListener()`를 사용해 요소에 핸들러를 부착하게 되면 핸들러 내부의 `this`\n 값은 대상 요소를 가리키게 됩니다.</code></pre></div>\n<p>위의 사실을 인지한 상태에서, 에러가 발생했던 코드를 다시 확인해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentCategory <span class=\"token operator\">=</span> <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// ① init()이 호출될 곳은 클래스 App의 인스턴스 내부이다.</span>\n\t\t<span class=\"token comment\">//    따라서 init()의 this에는 App의 인스턴스가 바인딩 된다.</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ② init()의 this에는 App의 인스턴스가 바인딩 되어있다.</span>\n    <span class=\"token comment\">//    따라서 App의 메서드인 this.render()가 정상 작동한다.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n\t\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// ④ changeCategory()의 this에는 nav요소가 바인딩되어 있다.</span>\n      <span class=\"token comment\">//    nav요소에는 render라는 함수가 정의되어있지 않다.</span>\n      <span class=\"token comment\">//    따라서 this.render()는 작동하지 않는다.</span>\n      <span class=\"token comment\">//</span>\n      <span class=\"token comment\">//    Uncaught TypeError: </span>\n      <span class=\"token comment\">//    this.render is not a function at HTMLElement.changeCategory </span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ③ addEventListener()를 사용해 nav 요소에 핸들러를 부착하게 되면</span>\n    <span class=\"token comment\">//    핸들러 내부의 this는 nav 요소를 가리키게 된다.</span>\n    <span class=\"token comment\">//    따라서 this.changeCategory의 this에는 nav 요소가 바인딩 된다.</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nav\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>changeCategory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>제가 헷갈렸던 이유가 명확해졌습니다.</p>\n<p>저는 <code class=\"language-text\">this</code> 바인딩을 함수 호출 방식이 아니라, 함수를 정의한 스코프에 따라 달라지는 것으로 착각하고 있었습니다.</p>\n<p>그래서, \" <code class=\"language-text\">init</code>과 <code class=\"language-text\">changeCategory</code>는 둘 다 <code class=\"language-text\">App</code>이라는 클래스 레벨의 스코프에 정의되어 있으니까, 두 메서드의 <code class=\"language-text\">this</code>는 <code class=\"language-text\">App</code>의 인스턴스를 가리켜야 하는 거 아니야?\"라는 생각을 가지고 있었습니다.</p>\n<p>하지만, <code class=\"language-text\">this</code>가 함수 호출 방식에 따라 달라지거나, <code class=\"language-text\">addEventListener</code>의 핸들러로 사용될 경우 달라진다는 것을 알게 되고, 제가 어느 부분을 착각했는지 명확히 할 수 있었습니다.</p>\n<h2>해결 과정</h2>\n<p>이 문제를 해결하기 위해서는 결국,</p>\n<p><code class=\"language-text\">changeCategory</code>의 <code class=\"language-text\">this</code>가 가리키는 대상을 <code class=\"language-text\">nav</code> 요소가 아닌, 클래스 <code class=\"language-text\">App</code>의 인스턴스로 바꿔주면 됩니다.</p>\n<p>이럴 때 사용할 수 있는 메서드를 아래에 소개합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Function.prototype.apply \n- 함수를 호출하면서 첫 번째 인수로 전달한 특정 객체를, 호출한 함수의 this에 바인딩한다. \n- 호출할 함수의 인수를 배열로 묶어 전달한다.\n- 예시: func.apply(arg, [1, 2, 3])\n\nFunction.prototype.call\n- 함수를 호출하면서 첫 번째 인수로 전달한 특정 객체를, 호출한 함수의 this에 바인딩한다. \n- 호출할 함수의 인수를 쉼표로 구분한 리스트 형식으로 전달한다.\n- 예시: func.call(arg, 1, 2, 3)\n\nFunction.prototype.bind\n- 함수를 호출하지 않고 첫 번째 인수로 전달한 값으로 this 바인딩이 교체된 함수를 새롭게 생성해 반환한다.</code></pre></div>\n<p>저의 경우 이벤트핸들러로 전달할 함수의 <code class=\"language-text\">this</code> 바인딩을 변경해야 하기 때문에, 함수를 호출할 필요는 없었습니다.</p>\n<p>따라서 <code class=\"language-text\">bind</code> 메서드를 사용해서 에러를 해결했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentCategory <span class=\"token operator\">=</span> <span class=\"token string\">\"coffee\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ① initEventListener()가 호출될 곳은 클래스 App의 인스턴스 내부이다.</span>\n    <span class=\"token comment\">//    따라서 initEventListener()의 this에는 App의 인스턴스가 바인딩 된다.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n\t\n  <span class=\"token function\">changeCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// ④ 이제 changeCategory()의 this에는 App의 인스턴스가 바인딩 되어있다.</span>\n      <span class=\"token comment\">//    따라서 App의 메서드인 this.render()가 정상 작동한다.</span>\n      <span class=\"token comment\">//    에러 해결 완료!</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">initEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// ② initEventListener()의 this에는 App의 인스턴스가 바인딩 되어있다.</span>\n      <span class=\"token comment\">//    addEventListener() 때문에 this.changeCategory에는 nav 요소가 바인딩 된다.</span>\n\n      <span class=\"token comment\">//    this.changeCategory.bind(this), 이렇게 작성해주면</span>\n      <span class=\"token comment\">//    this.changeCategory의 this가 nav가 아닌 App의 인스턴스를 가리키게 된다.</span>\n      <span class=\"token comment\">//    .bind(this)에서 this는, initEventListener()의 this이고,</span>\n      <span class=\"token comment\">//    initEventListener()의 this는, App의 인스턴스를 가리키고 있기 때문이다.</span>\n\t    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nav\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">changeCategory</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\t</code></pre></div>\n<h2>마치며</h2>\n<p>“모던 자바스크립트 딥 다이브”를 나름 여러번 읽어왔기 때문에, 누군가 this에 대해 묻는다면 그럭저럭 대답할 수 있다고 생각했습니다.</p>\n<p>하지만, 실제로 코드를 구현하면서 this를 다루기 시작하니, 제가 정말 애매하게 알고 있었다는 생각이 들었습니다.</p>\n<p>책으로 공부했던 경험보다는, 이렇게 뭔가를 구현하면서 발생한 에러를 해결하며 공부한 경험이 더 강하게 머릿속에 남는 것 같습니다.</p>\n<p>또 새로운 글로 찾아뵙겠습니다.</p>\n<h2>참고자료</h2>\n<ul>\n<li>모던 자바스크립트 Deep Dive: 자바스크립트의 기본 개념과 동작 원리 by 이웅모 (출처: 위키북스, 2020), p. 342-358 “22장 this”</li>\n</ul>\n<p>도서 구매 링크: <a href=\"https://product.kyobobook.co.kr/detail/S000001766445\">https://product.kyobobook.co.kr/detail/S000001766445</a></p>\n<ul>\n<li>EventTarget.addEventListener() by MDN Web Docs, accessed March 28, 2023</li>\n</ul>\n<p>문서 링크: <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#other_notes\">https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#other_notes</a></p>","frontmatter":{"title":"This 바인딩은 함수 호출 방식에 따라 결정된다","date":"March 28, 2023","description":"Uncaught TypeError: this.render is not a function... 대체 왜??","mobileImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVR42j1TTWsTURSdXyEUpS1N6iSZTNpQm8zks6VaFUoripuCFrvoylIRsSAKglLwJ4goJpmZzExSWppgigtBSiFCKV24Kl2JuCpd9A8cOXdmsnjM4717zj3n3DdK/rqDQrKJ6oQHM9lEbtxGMdWUs+m4jWrGk7u8aqOiu7IvpII71rD2RizYl3UXCgkrGU8KSukAYKgOymkXhuoicaWG7IiFiWsNZEdtWQRWdA9mIiBkU+65FDKTgMqo0Ew4MJMOCikPD+/Y2Hrdw4v1Lp4/7WLrTQ8P5huYjjuCIZbE8g2diEJ2JDtV8TKvOpgaqWNldRft43/4dtDG/mEb/tFfrKzuwIhbooxYEkeLeIXK2IV2qS7IzEdJtXBzqYP3231cnt7F+e95vGv/wtzSHoyxmiiamfRRJlZzpQEdKgyY7MzQDEM2Eg6MWB237nXxYbePs8MZtD7m8crq4/b9DsxYXQZDJ/yWwzwpTimSXXMHwRZTbpDluI1HT3bQOrnA/lEf/o8DfPr5B8uPW8iNWYJhY7qTl6G5mM36UEgS2A2ClZDlKThYnK3h7WYHm8++4+VGDxtrdSxUP6OU9gVDq8xRBhoppNXo3dE6C6OnRNLsaAOTw1+hDX2BfrWBXDys08JB6p4o5WCJVSgzIomCZSc+gaLWHGQ0N9USS9GPwHMZaMYbTJyE/wE8eK8bphXDwgAAAABJRU5ErkJggg=="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/2d230737eb93653d2c25fc54fdbf64a2/a22c4/js-512x256x2.png","srcSet":"/static/2d230737eb93653d2c25fc54fdbf64a2/cadb4/js-512x256x2.png 750w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/a22c4/js-512x256x2.png 856w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/7a9e5/js-512x256x2.png 1024w","sizes":"(min-width: 856px) 856px, 100vw"},"sources":[{"srcSet":"/static/2d230737eb93653d2c25fc54fdbf64a2/0b163/js-512x256x2.avif 750w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/1167a/js-512x256x2.avif 856w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/02545/js-512x256x2.avif 1024w","type":"image/avif","sizes":"(min-width: 856px) 856px, 100vw"},{"srcSet":"/static/2d230737eb93653d2c25fc54fdbf64a2/11ba1/js-512x256x2.webp 750w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/024d1/js-512x256x2.webp 856w,\n/static/2d230737eb93653d2c25fc54fdbf64a2/25be2/js-512x256x2.webp 1024w","type":"image/webp","sizes":"(min-width: 856px) 856px, 100vw"}]},"width":856,"height":428}}}}},"previous":{"fields":{"slug":"/js-clean-code/"},"frontmatter":{"title":"자바스크립트 코드 작성 시 참고 사항"}},"next":null},"pageContext":{"id":"7cd25617-fbca-59ef-afd5-423ecd315638","previousPostId":"cee289d8-7d10-59ed-a86b-4d87380f2239","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}