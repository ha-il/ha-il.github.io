{"componentChunkName":"component---src-templates-blog-post-js","path":"/configure/cra-configure/ci-cd/","result":{"data":{"site":{"siteMetadata":{"title":"하일의 작업실"}},"markdownRemark":{"id":"2f83e4b3-32bf-518b-8db2-984e99fa09c8","excerpt":"이전 글 \"[CRA 환경설정] Husky 환경 설정\"에서 이어지는 글입니다. 들어가기 전에 지난 글에서는 Husky 설정을 끝으로, 개발 환경에서의 환경설정을 완료했다. 이번 글에서는 AWS S3로 배포한 정적 사이트의 CI/CD…","html":"<p>이전 글 <a href=\"https://ha-il.github.io/configure/cra-configure/husky-config/\">\"[CRA 환경설정] Husky 환경 설정\"</a>에서 이어지는 글입니다.</p>\n<h2>들어가기 전에</h2>\n<p>지난 글에서는 Husky 설정을 끝으로, 개발 환경에서의 환경설정을 완료했다. 이번 글에서는 AWS S3로 배포한 정적 사이트의 CI/CD 환경 설정 과정을 다뤄보려고 한다. 배포를 자동화하는 과정을 중점적으로 정리하고 싶기 때문에, AWS S3에 정적 사이트를 배포하는 방법은 다루지 않는다.</p>\n<h2>1. 배포를 자동화해야하는 이유는?</h2>\n<p>AWS S3로 배포할 경우 아래와 같은 순서대로 배포가 진행된다.</p>\n<p>변경사항 푸쉬 → 빌드 → S3 버킷 비우기 → 빌드 파일 업로드 → 배포</p>\n<p>푸쉬와 빌드는 명령어만 입력하면 되니까 참고 넘어갈 수 있지만, 푸시하고 빌드할 때마다 S3 버킷을 비우러 AWS 웹사이트에 접속해야 한다면 정말 귀찮을 것이다. 일단 빌드와 동시에 배포가 이뤄질 수 있도록 빌드와 배포 과정을 자동화해야할 필요가 있다.</p>\n<h2>2. 배포를 자동화해보자.</h2>\n<p>배포 자동화 과정이 잘 이뤄지고 있는지 확인하기 위해, 먼저 현재 S3에 배포되고 있는 내 웹 사이트를 공개한다!</p>\n<p><img src=\"https://github.com/ha-il/ha-il.github.io/assets/108077643/6c66af96-5d33-4f97-8820-6d5089905ea5\" alt=\"deploy-one\"></p>\n<p>(<del>짜잔!</del>...)</p>\n<p>... 여기에 문장을 하나씩 추가해보면서 배포가 잘 진행되고 있는지 확인해보자.</p>\n<p><strong>1. 먼저, aws-cli를 설치하자.</strong></p>\n<p>AWS CLI는 <a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html#getting-started-install-instructions\">AWS-Install or update the latest version of the AWS CLI</a>에서 자신의 운영체제에 맞는 방법으로 설치하면 된다.</p>\n<p>설치가 잘 진행 됐다면, <code class=\"language-text\">aws --version</code> 명령어를 터미널에 입력했을 때 aws-cli 버전이 뜰 것이다.</p>\n</br>\n<p><strong>2. aws에서 엑세스 키를 만든다.</strong></p>\n<p>aws-cli으로 자신의 인증 정보를 입력하기 위해 필요하다. 엑세스 키는 AWS 웹사이트에 접속하고 로그인을 하면 만들 수 있다. 자세한 과정은 <a href=\"https://docs.aws.amazon.com/ko_kr/powershell/latest/userguide/pstools-appendix-sign-up.html\">AWS 계정 및 액세스 키</a>를 참고하면 된다.</p>\n</br>\n<p><strong>3. <code class=\"language-text\">aws configure</code> 명령어를 입력하여 보안 인증 정보, 리전 및 출력 형식을 빠르게 설정한다.</strong></p>\n<p>명령어를 입력하고 나면 아래 항목이 순서대로 등장하는데, 자신의 상황에 맞게 입력하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">AWS Access Key ID [None]: # 자신의 액세스 키\nAWS Secret Access Key [None]: # 자신의 시크릿 액세스 키\nDefault region name [None]: ap-northeast-2 # 내 기준으로 가장 가까운 리전 선택\nDefault output format [None]: # 생략해도 됨, 예시에는 json을 사용</code></pre></div>\n</br>\n<p><strong>4. <code class=\"language-text\">aws s3 ls</code> 명령어를 입력한다.</strong></p>\n<p>인증이 잘 진행됐다면, 명령어를 입력했을 때 인증 정보를 등록한 계정의 버킷 리스트가 나온다. 나의 경우 버킷의 이름인 cra-config가 나왔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2023-08-28 17:59:40 cra-config</code></pre></div>\n</br>\n<p><strong>5. aws-cli로 내 빌드 폴더를 버킷에 업로드한다.</strong></p>\n<p>버킷에 폴더를 업로드하는 명령어는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws s3 sync 업로드할폴더/ 버킷이름 --delete</code></pre></div>\n<p>업로드할 폴더는 자신이 버킷에 업로드할 폴더 이름을 입력하면 된다. 버킷 이름은 <code class=\"language-text\">s3://버킷이름</code>의 형식으로 입력하면 된다. <code class=\"language-text\">--delete</code>는 기존 버킷의 내용을 삭제하고 업로드하는 것이다.</p>\n<p>명령어를 입력하기 전에! 배포가 잘 되고 있는지 확인하기 위해, 변경사항을 추가하고 다시 빌드를 진행했다.</p>\n<p>그리고 아래와 같이 명령어를 작성해서 실행했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws s3 sync build/ s3://cra-config --delete</code></pre></div>\n<p>그리고 배포 사이트를 다시 가보니 아래와 같이 변경사항이 잘 적용되었다.</p>\n<p><img src=\"https://github.com/ha-il/ha-il.github.io/assets/108077643/18174595-edc8-4804-bfc3-1410339f1fc2\" alt=\"deploy-two\"></p>\n<p>(<del>짜잔2</del>...)</p>\n</br>\n<p><strong>6. 빌드와 동시에 배포가 될 수 있도록 package.json 파일에 deploy라는 스크립트를 만든다.</strong></p>\n<p>aws-cli로 배포하는 방법을 알았으니, 이번에는 빌드와 배포가 동시에 진행될 수 있도록 스크립트를 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint . --cache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier . --write --cache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prepare\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"husky install\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// deploy 추가!</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build &amp;&amp; aws s3 sync build/ s3://cra-config --delete\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>변경 사항을 만들고 <code class=\"language-text\">npm run deploy</code>를 실행했더니, 아래와 같이 변경 사항이 잘 적용되었다.</p>\n<p><img src=\"https://github.com/ha-il/ha-il.github.io/assets/108077643/ed0017fa-1444-4439-b21c-1e339379e032\" alt=\"deploy-three\"></p>\n<p>(<del>이쯤 되니 정든다</del>)</p>\n<p>변경사항 푸쉬 → 빌드 → S3 버킷 비우기 → 빌드 파일 업로드 → 배포. 이렇게 총 5단계로 이뤄지던 배포 과정이 변경사항 푸쉬 → 빌드 → 배포, 이렇게 3단계로 줄었고 심지어 빌드 명령어 하나만 입력하면 배포까지 되도록 설정했다. 너무 좋다. 하지만 뭔가 부족한 점이 있다. 이 과정은 오직 내 컴퓨터에서만 실행된다는 점이다. 만약 이것이 팀 프로젝트라면 어떨까? 빌드와 배포가 동시에 진행되도록 만들기 위해 건너온 지난한 과정을 다른 팀원들도 그대로 겪어야 한다. 이런 과정을 팀원들이 겪지 않게 자동화하는 방법은 없을까? 이때 사용되는 개념이 CI/CD이다.</p>\n<h2>3. CI/CD</h2>\n<ul>\n<li>\n<p><strong>CI</strong>: Continuous Integration</p>\n<ul>\n<li>코드를 테스트해서 유효한지 검증하고 통합하는 과정을 자동화하는 것</li>\n</ul>\n</li>\n<li>\n<p><strong>CD</strong>: Continuous Delivery/Deployment</p>\n<ul>\n<li>CI를 통해 통합된 코드들을 Production 환경에 배포하는 과정을 자동화하는 것</li>\n<li>Delivery: 개발환경까지의 배포를 자동화 된 것</li>\n<li>Deployment: Production 환경의까지의 배포를 자동화 한 것</li>\n</ul>\n</li>\n</ul>\n<p>즉, <strong>CI/CD</strong>는 CI/CD 파이프라인을 구축해서 <strong>빌드, 테스트, 배포 등의 과정을 자동화하는 것</strong>을 의미한다.</p>\n<h3>3.1 CI/CD 플랫폼</h3>\n<p>CI/CD 플랫폼은 <strong>설치형</strong>과 <strong>클라우드형</strong>으로 나뉜다.</p>\n<p><strong>설치형</strong>은 CI/CD 파이프라인을 구축하는 개발자가 직접 특정 컴퓨터에 CI/CD 플랫폼을 설치해서 활용한다. 대표적인 설치형 CI/CD 플랫폼으로는 Jenkins가 있다.</p>\n<p><strong>클라우드형</strong>은 서비스 제공자가 클라우드에서 CI/CD 플랫폼을 운영해주는 형태이다. 별도의 컴퓨팅 자원에 대한 관리 없이 CI/CD 파이프라인 구축에만 신경 쓸 수 있다. 대표적인 클라우드형 CI/CD 플랫폼으로는 GitHub Actions, Travis CI가 있다.</p>\n<p>이번 프로젝트에서는 <strong>GitHub Actions</strong>를 사용해보려고 한다. 깃헙 저장소와의 연동이 간편하고 레퍼지토리 안에서 CI/CD를 함께 구축할 수 있다. 무엇보다 퍼블릭 레퍼지토리는 공짜다.</p>\n<h3>3.2 CI/CD 플랫폼을 사용하기 전에</h3>\n<p>CI/CD 플랫폼을 사용하기 전에 우선 무엇을 자동화할 것인지 생각해봐야 파이프라인을 구축할 수 있다.</p>\n<p>일단, 나의 경우 이번에는 배포의 자동화를 중점적으로 다루고 싶다. 그래서 deploy 스크립트로 빌드와 배포과정을 통합했다. 하지만 그 조차도 입력하지 않고, <strong>main 브랜치에 푸쉬하기만 하면 빌드와 배포가 자동으로 진행</strong>되었으면 좋겠다. 이 과정을 CI/CD 파이프라인으로 GitHub Actions을 통해 구축해보자.</p>\n<h2>4. GitHub Actions</h2>\n<p>GitHub Actions를 사용하기 전에 기본적인 용어를 알고가면 이해하기 쉽다. 아래 이미지는 <a href=\"https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#the-components-of-github-actions\">GitHub Docs-Understanding GitHub Actions</a>에서 가져왔다.</p>\n<img src=\"https://docs.github.com/assets/cb-25535/mw-1440/images/help/actions/overview-actions-simple.webp\" width=\"100%\" alt=\"The components of GitHub Actions\">\n<ul>\n<li>\n<p><strong>Workflow</strong></p>\n<ul>\n<li>GitHun Actions상에서 실행될 자동화된 일련의 작업 흐름을 의미</li>\n<li>YAML 형식의 파일을 통해서 Workflow를 설정</li>\n</ul>\n</li>\n<li>\n<p><strong>Event</strong></p>\n<ul>\n<li>레파지토리에서 발생하는 push, pull request open, issue open등의 특정한 활동을 의미</li>\n</ul>\n</li>\n<li>\n<p><strong>Runner</strong></p>\n<ul>\n<li>workflow를 실행할 서버를 의미</li>\n</ul>\n</li>\n<li>\n<p><strong>Jobs</strong></p>\n<ul>\n<li>하나의 runner에서 실행될 여러 step의 모음을 의미</li>\n<li>job안의 step들은 순차적으로 실행</li>\n<li>workflow의 job들은 기본적으로 병렬로 실행</li>\n</ul>\n</li>\n<li>\n<p><strong>step</strong></p>\n<ul>\n<li>실행가능한 하나의 shell script 또는 action을 의미</li>\n</ul>\n</li>\n</ul>\n<h3>4.1 GitHub Actions 초기 설정</h3>\n<p>본격적으로 GitHub Actions를 이용해 CI/CD 파이프라인을 구축해보자. 참고로 이 과정은 <a href=\"https://docs.github.com/en/actions/quickstart\">GitHun Docs-GitHub Actions-Quickstart</a>를 참고했다.</p>\n<p><strong>1. 먼저, 루트 디렉터리에 .github/workflows 폴더를 생성한다.</strong></p>\n<br/>\n<p><strong>2. .github/workflows 폴더에 github-actions-demo.yml 파일을 만든다.</strong></p>\n<p>yml 파일의 이름은 마음대로 지어도 된다.</p>\n<br/>\n<p><strong>3. github-actions-demo.yml 파일에 아래와 같이 작성한다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Actions Demo\n<span class=\"token key atrule\">run-name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.actor <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> is testing out GitHub Actions 🚀\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>push<span class=\"token punctuation\">]</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Explore-GitHub-Actions</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"🎉 The job was automatically triggered by a $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.event_name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> event.\"\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"🐧 This job is now running on a $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> server hosted by GitHub<span class=\"token tag\">!</span>\"\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"🔎 The name of your branch is $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> and your repository is $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.repository <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>.\"\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check out repository code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"💡 The $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.repository <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> repository has been cloned to the runner.\"\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"🖥️ The workflow is now ready to test your code on the runner.\"\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> List files in the repository\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          ls ${{ github.workspace }}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"🍏 This job's status is $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> job.status <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>.\"</code></pre></div>\n<br/>\n<p><strong>4. git push 이벤트를 발생시키고 깃헙 저장소의 actions 탭에서 action 실행 결과를 확인한다.</strong></p>\n<p>아래 링크에는 깃헙 저장소에서 GitHub Actions의 워크플로우 결과를 확인하는 방법이 나와있다. 아래 링크를 참고하길 바란다.</p>\n<p><a href=\"https://docs.github.com/en/actions/quickstart#viewing-your-workflow-results\">GitHub Actions-QuickStart-Viewing your workflow results</a></p>\n<h3>4.2 워크플로우 문법 살펴보기</h3>\n<p>위에서 다룬 워크플로우 파일은 어디까지나 작동이 되나 확인하는 용도이다. 프로젝트의 배포를 위해서는 조금 더 세부적인 설정이 필요하다. 워크플로우 파일을 세부적으로 설정하려면 문법을 알아야 하는데, 문법의 양도 방대하고 실제로 다 쓰일지도 잘 모르기 때문에, 일단 내가 실제 프로젝트에서 사용해봤던 문법 위주로 정리하려고 한다. 만약 모든 문법 사항이 궁금하다면 <a href=\"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#about-yaml-syntax-for-workflows\">GitHub Actions-Workflow syntax for GitHub Actions</a>를 참고하기를 바란다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Actions Demo <span class=\"token comment\"># 워크 플로우 이름</span>\n<span class=\"token key atrule\">run-name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.actor <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> is testing out GitHub Actions 🚀\n<span class=\"token comment\"># run-name: 깃헙 저장소 actions 탭을 클릭하면 나오는 리스트에 표시되는 이름</span>\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 워크플로우를 실행할 이벤트를 정의</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># push 이벤트 감지</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 특정 branch만 지정할 수도 있음</span>\n      <span class=\"token punctuation\">-</span> main\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Explore-GitHub-Actions</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># job 이름</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest <span class=\"token comment\"># runner의 운영체제</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check out repository code  <span class=\"token comment\"># name: 깃헙에 표시되는 step의 이름</span>\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3 <span class=\"token comment\"># uses: job에 사용할 actions를 step으로 추가</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token comment\"># run: 운영체제의 셸을 사용하여 명령어를 실행</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run test\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build</code></pre></div>\n<p>참고로 <code class=\"language-text\">uses: actions/checkout@v3</code>에서 의미하는 <strong>action</strong>은 워크플로우에서 자주 사용되는 기능들을 모아둔 일종의 커스텀 애플리케이션이다. <a href=\"https://github.com/marketplace?type=\">GitHub Marketplace</a>에서 action을 검색하고 워크플로우에서 활용할 수 있다.</p>\n<h3>4.3 GitHub Actions로 CI/CD 파이프라인 구축하기</h3>\n<p>Github Actions로 워크플로우를 작성하고 실행하는 방법을 알아봤으니, 본격적으로 CI/CD 파이프라인을 구축해보려 한다. 파이프라인은 아래와 같은 순서로 구성하려 한다.</p>\n<ol>\n<li>main 브랜치에 푸쉬 하면</li>\n<li>의존성을 설치하고(내 깃헙 저장소에는 node-modules가 없으니까)</li>\n<li>테스트를 실행하고(아직 기본 테스트 코드지만 CI 과정에 필수적이므로)</li>\n<li>빌드하고</li>\n<li>S3로 배포한다</li>\n</ol>\n<p>사실 내가 위에서 문법을 살펴보는 용도로 작성했던 워크플로우 파일은 이미 네번쩨 순서인 빌드 과정까지 설정된 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Actions Demo \n<span class=\"token key atrule\">run-name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.actor <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> is testing out GitHub Actions 🚀\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> main <span class=\"token comment\"># 1. main 브랜치에 푸쉬하면</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Explore-GitHub-Actions</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest \n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check out repository code  \n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3 \n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token comment\"># 2. 의존성을 설치하고</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run test <span class=\"token comment\"># 3. 테스트를 실행하고</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build <span class=\"token comment\"># 4. 빌드하고</span>\n      <span class=\"token comment\"># 5. S3로 배포한다... 는 어딨어?</span></code></pre></div>\n<p>어려운 부분은 배포 과정에 대한 워크플로우 설정이다. 왜냐면 이 부분에는 aws의 엑세스 키가 필요하기 때문이다. aws s3처럼 자주 사용되는 서비스에 대한 step을 정의해야 할 때는 이미 만들어진 action이 있는지 확인해보면 좋다.</p>\n<p><a href=\"https://github.com/marketplace?type=\">GitHub Marketplace</a>에서 s3 관련 action을 검색해보니 <a href=\"https://github.com/marketplace/actions/s3-sync\">S3 Sync</a>라는 action이 나왔다. 사용법을 잘 읽어보고 워크플로우 파일에 적용해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Actions Demo \n<span class=\"token key atrule\">run-name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.actor <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> is testing out GitHub Actions 🚀\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> \n      <span class=\"token punctuation\">-</span> main <span class=\"token comment\"># 1. main 브랜치에 푸쉬하면</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Explore-GitHub-Actions</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest \n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check out repository code  \n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3 \n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token comment\"># 2. 의존성을 설치하고</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run test <span class=\"token comment\"># 3. 테스트를 실행하고</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build <span class=\"token comment\"># 4. 빌드하고</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> jakejarvis/s3<span class=\"token punctuation\">-</span>sync<span class=\"token punctuation\">-</span>action@master <span class=\"token comment\"># 5. S3로 배포한다.</span>\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>delete <span class=\"token comment\"># aws s3 cli에 넘겨줄 옵션</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">AWS_S3_BUCKET</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_S3_BUCKET <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># s3 버킷 이름</span>\n          <span class=\"token comment\"># 절대 여기에 aws 엑세스 키를 직접 입력하면 안 된다!!!!!!!!!!!!!!!!!!!</span>\n          <span class=\"token key atrule\">AWS_ACCESS_KEY_ID</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_ACCESS_KEY_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># aws 액세스 키</span>\n          <span class=\"token comment\"># 절대 여기에 aws 시크릿 엑세스 키를 직접 입력하면 안 된다!!!!!!!!!!!!!!!!!!!</span>\n          <span class=\"token key atrule\">AWS_SECRET_ACCESS_KEY</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SECRET_ACCESS_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># aws 시크릿 액세스 키 </span>\n          <span class=\"token key atrule\">AWS_REGION</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ap-northeast-2'</span> <span class=\"token comment\"># aws 리전</span>\n          <span class=\"token key atrule\">SOURCE_DIR</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'public'</span> <span class=\"token comment\"># 업로드할 폴더</span>\n      </code></pre></div>\n<p><strong>🚨 절대 워크플로우 파일에 직접 aws 엑세스 키와 시크릿 엑세스 키를 입력하면 안 된다! 🚨</strong></p>\n<p><code class=\"language-text\">${{ secrets. }}</code>형식의 값들은 워크플로우 파일이 아니라 깃헙 저장소 페이지의 <code class=\"language-text\">settings</code>탭에서 설정해줘야 한다. 설정하는 방법은 <a href=\"https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository\">GitHub Actions - Creating encrypted secrets for a repository</a>를 따라하면 된다.</p>\n<p>위와 같이 설정했으면 내가 의도했던 CI/CD 파이프라인 구축은 완성이다. 실제로 테스트를 해보자.</p>\n<h2>4.5 GitHub Actions로 구축한 CI/CD 파이프라인 테스트</h2>\n<p>현재 aws s3를 통해 배포되고 있는 내 웹사이트는 아래와 같은 상태이다.</p>\n<p><img src=\"https://github.com/ha-il/ha-il.github.io/assets/108077643/ed0017fa-1444-4439-b21c-1e339379e032\" alt=\"deploy-three\"></p>\n<p>(<del>또 너냐</del>...)</p>\n<p>여기에 4번째 문장을 추가하고 커밋한 다음 깃헙 저장소에 푸쉬하면, GitHub Actions가 내 워크플로우 파일을 실행시켜서 자동으로 테스트, 빌드, 배포가 이뤄져야 한다. 확인을 위해서 아래와 같은 과정을 거쳤다.</p>\n<p><strong>1. 변경 사항을 저장하고 깃헙 저장소에 푸쉬한다.</strong></p>\n<p><strong>2. 깃헙 저장소 페이지의 actions 탭을 확인한다.</strong></p>\n<p><img src=\"https://github.com/ha-il/cra-config/assets/108077643/775ac44f-ce46-43bb-b6b8-d0b6e7860886\" alt=\"github-actions\"></p>\n<p>actions 탭을 보니 사전에 정의한 워크플로우가 잘 진행되었음을 확인할 수 있었다.</p>\n<p><strong>3. AWS S3로 배포되고 있는 정적 사이트에 접속해본다.</strong></p>\n<p>과연 내가 입력한 네번째 문장은 잘 배포되었을까...?</p>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<p><img src=\"https://github.com/ha-il/cra-config/assets/108077643/1c1d1b2d-9d84-4694-acf5-f35013bdc4a0\" alt=\"deploy-four\"></p>\n<p>(<del>짜잔!</del>...)</p>\n<p>이렇게 깃 푸쉬만으로 테스트, 빌드, 배포를 자동으로 진행할 수 있는 CI/CD 파이프라인을 Github Actions로 구축해봤다.</p>\n<h2>마치며</h2>\n<p>글 제목은 \"CI/CD 환경 구축하기\"라고 했지만 사실 절반 정도만 구축한 것이다. 왜냐면 CI에 해당하는 테스트 과정이 너무 간소화된 상태로 파이프라인을 구축했기 때문이다. 아직 테스트 코드를 작성해 본 경험이 없기 때문에 이번에는 제대로 다루지 못 했지만, 테스트 코드를 학습하게 되면 CI 과정을 중점으로 새로운 글을 다시 올리겠다.</p>\n<p>그동안 타입스크립트, ESLint, Prettier, Husky, AWS, Github Actions 등 생각보다 많은 것을 다뤘다. 이번 시리즈를 작성하면서 느낀 점은 환경 설정이 꽤 재미있다는 것이다. 파고들면 파고들수록 내가 커스텀할 수 있는 요소들이 나오고, 또 그것을 바로 설정해서 프로젝트에 적용시켜 볼 수 있으니 꽤 재미있게 느껴졌다. 그리고 늘 지나가듯이 들어봤던 용어와 기술들을 이번 기회에 제대로 다뤄봐서 속이 좀 시원하다.</p>\n<p>아무튼 CRA 환경설정 시리즈는 여기서 마무리 짓겠다.</p>\n<p>그럼, 안녕히~👋</p>","frontmatter":{"title":"[CRA 환경설정] AWS S3로 배포한 사이트의 CI/CD 환경 구축","date":"August 28, 2023","description":"GitHub Actions로 CI/CD 환경을 구축해보자.","mobileImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVR42j1Su24TURCdtWPHDkR0BIIFiTC2d/0kdggJ2F4/dm0s8SgSKSl4RyAakihYa4mCKJKhAVFQIBokBBINXb4C5Qf4m4POXK+L0b26d+bMOWdGJNvEjNPGXKWHqNOCZBqI5dv6JtfqmCv7GlauiWTJ0/tM3vwxJ5bvQNLmnih5EAImy74mzBa7OFPpIZJzkSh6kKwLOV+BLG1AUmuQpXXI8oYWEjxqt7Q5m/DOECJbOVeZkWHEdvWMOm3UHjzBcPwJT/cDPDsYIXj/GU5vWxmxKWsV2GkZJZWeYZiYdCNDlZptQq7eQn1zF4cffuDx0W88H//Bwfg7bt57CMt2jexsU4GtScxSFZklS76CkV3oWbzYxWKtj4tegNLoFNW3p7jQ2kNq1ddikjh7va9nvNBRL3UG9IBd6KHxpDPteHltgIXOEPV3f/Hm5z/Yd4dYrPqITobGQZEpQSO2GagQnREaS0B+Mhqbuxh9/IXgywmOv51g//graoMdlapEbFfV6WYUOspYQu94EpQJ6k+6jkx3Cy+DIzx6HWD71SG2XuxhuXFf7WBNvNA1fnOgIUNKjU0luJpohauUvq1rIlfWIZdWIakbWkSLCEYQI9d4ylqZX7kzBZkam2noPtIK9ajo4Vx1gPmVvuaxuargQMu+EiJTAv4HUPM5JxwKACcAAAAASUVORK5CYII="},"backgroundColor":"transparent","images":{"fallback":{"src":"/static/c867c47d399ccc066f6c2be886c7ae06/a22c4/ts-512x256x2.png","srcSet":"/static/c867c47d399ccc066f6c2be886c7ae06/cadb4/ts-512x256x2.png 750w,\n/static/c867c47d399ccc066f6c2be886c7ae06/a22c4/ts-512x256x2.png 856w,\n/static/c867c47d399ccc066f6c2be886c7ae06/7a9e5/ts-512x256x2.png 1024w","sizes":"(min-width: 856px) 856px, 100vw"},"sources":[{"srcSet":"/static/c867c47d399ccc066f6c2be886c7ae06/0b163/ts-512x256x2.avif 750w,\n/static/c867c47d399ccc066f6c2be886c7ae06/1167a/ts-512x256x2.avif 856w,\n/static/c867c47d399ccc066f6c2be886c7ae06/02545/ts-512x256x2.avif 1024w","type":"image/avif","sizes":"(min-width: 856px) 856px, 100vw"},{"srcSet":"/static/c867c47d399ccc066f6c2be886c7ae06/11ba1/ts-512x256x2.webp 750w,\n/static/c867c47d399ccc066f6c2be886c7ae06/024d1/ts-512x256x2.webp 856w,\n/static/c867c47d399ccc066f6c2be886c7ae06/25be2/ts-512x256x2.webp 1024w","type":"image/webp","sizes":"(min-width: 856px) 856px, 100vw"}]},"width":856,"height":428}}}}},"previous":{"fields":{"slug":"/configure/cra-configure/husky-config/"},"frontmatter":{"title":"[CRA 환경설정] Husky 환경 설정"}},"next":{"fields":{"slug":"/react/rendering/browser-rendering/"},"frontmatter":{"title":"[리액트 렌더링] 브라우저의 렌더링 이해하기"}}},"pageContext":{"id":"2f83e4b3-32bf-518b-8db2-984e99fa09c8","previousPostId":"bcda3eeb-c4c0-5039-a57b-c331e09a49aa","nextPostId":"dee20714-5693-5403-9f43-66ebb7770489"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}